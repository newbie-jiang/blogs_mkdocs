## zephyr中我如何知道某些模块适用于哪些具体型号单片机？

- 比如crypto中的Kconfig.stm32  我如何知道哪些系列可以使用

![image-20250830014719453](https://newbie-typora.oss-cn-shenzhen.aliyuncs.com/TyporaJPG/image-20250830014719453.png)

drivers/crypto/Kconfig.stm32  其实是在用 **Devicetree 的“是否存在并启用某外设”** 来决定驱动是否参与编译：

```
depends on DT_HAS_ST_STM32_AES_ENABLED || DT_HAS_ST_STM32_CRYP_ENABLED
```

也就是说：**只要当前 SoC 的 Devicetree 里有 `st,stm32-aes` 或 `st,stm32-cryp`（且 status 为 "okay"）这个外设节点，STM32 的 crypto 驱动就会启用**。所以“适用于哪些具体型号单片机”，本质上看**哪些 SoC DTS(I) 定义了这些 compatible**。

下面有三个实用的“定位方法”，从“全局找系列”到“对某块板子验证”。



## 方法 1：全局搜 DTS(I) 看哪些系列/型号有这个外设

在 Zephyr 工作区里搜 **compatible** 出处（大多在 ST 的 Cube DTSI 内，少量在 Zephyr 的补丁 DTS 中）：

```
# 找 CRYP 外设
git grep -n 'compatible = "st,stm32-cryp"' -- dts modules/hal/stm32

# 找 AES 外设
git grep -n 'compatible = "st,stm32-aes"'  -- dts modules/hal/stm32

# 找 HASH 外设
git grep -n 'compatible = "st,stm32-hash"' -- dts modules/hal/stm32
```

命中的 `.dtsi` 路径名基本就对应系列/子系列（如 `stm32f4*.dtsi`、`stm32h7*.dtsi` 等）。把这些文件名列出来，就得到“哪些系列/具体 SoC 带该外设”。

> 规则小抄：`compatible: "st,stm32-xxx"` → 生成的 Kconfig 宏名就是 `DT_HAS_ST_STM32_XXX_ENABLED`（连字符转下划线、逗号去掉并大写）。

![image-20250830015101157](https://newbie-typora.oss-cn-shenzhen.aliyuncs.com/TyporaJPG/image-20250830015101157.png)



## 方法 2：对“某块板子/某个 SoC”直接验证

最靠谱的是**实际构建一次**，看生成结果：

```
west build -b <你的板卡> path/to/your/app -DCMAKE_EXPORT_COMPILE_COMMANDS=ON
# 生成后的 Devicetree：
less build/zephyr/zephyr.dts
# 或看生成的 DT 宏：
grep ST_STM32_.*_ENABLED build/zephyr/include/generated/devicetree_unfixed.h
```

- 如果看到 `st,stm32-cryp`/`st,stm32-aes`/`st,stm32-hash` 节点且 `status = "okay"`，那么对应 `DT_HAS_ST_STM32_*_ENABLED` 宏会存在，Kconfig 依赖就满足，驱动会被编进去。

- 若节点存在但 `status = "disabled"`，可在你的 **板级 overlay DTS** 里打开，例如：

  ```
  &cryp { status = "okay"; };
  &aes  { status = "okay"; };
  &hash { status = "okay"; };
  ```



## 方法 3：从 库文件中找

- 此种方式是直接看源码是否支持此模块，需要modules 目录下搜，为了节省时间，最好在自己想要查找的库中搜索

```
grep -R -n "USE_STM32_HAL_CRYP" /home/hdj/zephyrproject/modules/hal/stm32
```

![image-20250830020523902](https://newbie-typora.oss-cn-shenzhen.aliyuncs.com/TyporaJPG/image-20250830020523902.png)

## 总结

- 上述的三种方法，
- 首先推荐第一种，可以快速查找应用，有现成的设备树文件可以抄（此种方式会漏掉部分芯片，部分芯片实际支持但是没有写设备树文件）
- 其次是最后一种，这种方式从源码查最稳，