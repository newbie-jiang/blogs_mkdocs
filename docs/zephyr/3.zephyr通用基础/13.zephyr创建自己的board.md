# zephyr创建自己的board

参考官方说明 https://docs.zephyrproject.org/latest/hardware/porting/board_porting.html#board-porting-guide



上一节在原zephyr工程中创建了一个自己的目录以便开发

- 查找自己mcu是否支持zephyr https://docs.zephyrproject.org/latest/boards/index.html#    
- 或者在zephyr的boards目录中查看
- 目前主要支持 nordic  ST 以及NXP，intel 瑞萨    聆思科技要去官网下载他们的sdk   nordic完全支持zephyr了，也是要去官网下载他们的sdk
- 国产芯片厂大多数都没有

![image-20250802123105341](https://newbie-typora.oss-cn-shenzhen.aliyuncs.com/TyporaJPG/image-20250802123105341.png)



我使用的是stm32h7s78-dk,在boards内有支持，所以直接使用就好了，只需要更改一下名字就好了

一般来说适配自己的boards首先看芯片有没有支持，有支持再找同样芯片的board或者相近似的board，更改名字以及设备树



主板目录名无需与主板名称一致。甚至可以将多个主板定义在一个目录中

 board 目录应如下所示：

```
boards/<VENDOR>/plank
├── board.yml
├── board.cmake
├── CMakeLists.txt
├── doc
│   ├── plank.webp
│   └── index.rst
├── Kconfig.plank
├── Kconfig.defconfig
├── plank_<qualifiers>_defconfig
├── plank_<qualifiers>.dts
└── plank_<qualifiers>.yaml
```

必需的文件包括：

1. `board.yml`：一个 YAML 文件，用于描述开发板的高级元数据，例如开发板名称、SoC 及其变体。多核 SoC 的 CPU 集群未在此文件中描述，因为它们继承自 SoC 的 YAML 描述。
2. `plank_<qualifiers>.dts`[：设备](https://docs.zephyrproject.org/latest/build/dts/index.html#dt-guide)树格式的硬件描述。它声明了您的 SoC、连接器以及任何其他硬件组件，例如 LED、按钮、传感器或通信外设（USB、蓝牙控制器等）。
3. `Kconfig.plank`：用于选择 SoC 以及其他开发板和 SoC 相关设置的基本软件配置。不得选择开发板和 SoC 树之外的 Kconfig 设置。要选择常规 Zephyr Kconfig 设置，`Kconfig`必须使用该文件。

可选文件包括：

- `Kconfig`，[配置系统 (Kconfig)](https://docs.zephyrproject.org/latest/build/kconfig/index.html#kconfig)`Kconfig.defconfig`格式的软件配置 。这为软件功能和外设驱动程序提供了默认设置。
- `plank_defconfig`和`plank_<qualifiers>_defconfig`：Kconfig 格式的软件配置`.conf`。
- `board.cmake`：用于[Flash 和调试支持](https://docs.zephyrproject.org/latest/hardware/porting/board_porting.html#flash-and-debug-support)
- `CMakeLists.txt`：如果您需要向您的构建添加额外的源文件。
- `doc/index.rst`，`doc/plank.webp`：开发板的文档和图片。只有当你将[开发板贡献](https://docs.zephyrproject.org/latest/hardware/porting/board_porting.html#contributing-your-board)给 Zephyr 时才需要这些。
- `plank_<qualifiers>.yaml`[：包含测试运行器（Twister）](https://docs.zephyrproject.org/latest/develop/test/twister.html#twister-script)使用的各种元数据的 YAML 文件。

形式为 的板限定符`<soc>/<cpucluster>/<variant>`被规范化，以便在用于文件名时`/`被替换为`_`，例如： 在用于文件名时`soc1/foo`变为。`soc1_foo`

## 1.更改board文件名字

![image-20250802194635503](https://newbie-typora.oss-cn-shenzhen.aliyuncs.com/TyporaJPG/image-20250802194635503.png)

![image-20250802194615605](https://newbie-typora.oss-cn-shenzhen.aliyuncs.com/TyporaJPG/image-20250802194615605.png)

更改board名字，虽然可以与目录不一致，但是为了方便查找，最好还是一致吧

## 2.更改board.yml文件

原文件

```
board:
  name: stm32h7s78_dk
  full_name: STM32H7S78-DK Discovery
  vendor: st
  socs:
    - name: stm32h7s7xx
```

更改后

- 更改 name: h7s78

```
board:
  name: h7s78
  full_name: STM32H7S78-DK Discovery
  vendor: st
  socs:
    - name: stm32h7s7xx
```





## 3.更改 h7s78.yaml

更改前

```
identifier: stm32h7s78_dk
name: ST STM32H7S78 Discovery Kit
type: mcu
arch: arm
toolchain:
  - zephyr
ram: 640
flash: 64
supported:
  - arduino_gpio
  - gpio
  - uart
  - watchdog
  - entropy
  - adc
  - octospi
  - usbd
  - memc
vendor: st
```

更改后

-  更改 identifier: h7s78

```
identifier: h7s78
name: ST STM32H7S78 Discovery Kit
type: mcu
arch: arm
toolchain:
  - zephyr
ram: 640
flash: 64
supported:
  - arduino_gpio
  - gpio
  - uart
  - watchdog
  - entropy
  - adc
  - octospi
  - usbd
  - memc
vendor: st
```

## 4.更改Kconfig.defconfig



更改前

```
# STM32H7S78 DISCOVERY KIT board configuration
#
# Copyright (c) 2024 STMicroelectronics
#
# SPDX-License-Identifier: Apache-2.0
#

if BOARD_STM32H7S78_DK

if NETWORKING

config NET_L2_ETHERNET
	default y

endif # NETWORKING

endif # BOARD_STM32H7S78_DK

```

更改后

```
# STM32H7S78 DISCOVERY KIT board configuration
#
# Copyright (c) 2024 STMicroelectronics
#
# SPDX-License-Identifier: Apache-2.0
#

if BOARD_H7S78

if NETWORKING

config NET_L2_ETHERNET
	default y

endif # NETWORKING

endif # BOARD_H7S78
```

## 5.更改Kconfig.h7s78



更改前

```
# STM32H7S78-DK Discovery kit board configuration
#
# Copyright (c) 2024 STMicroelectronics
#
# SPDX-License-Identifier: Apache-2.0
#

config BOARD_STM32H7S78_DK
	select SOC_STM32H7S7XX

```

更改后

```
# STM32H7S78-DK Discovery kit board configuration
#
# Copyright (c) 2024 STMicroelectronics
#
# SPDX-License-Identifier: Apache-2.0
#

config BOARD_H7S78
	select SOC_STM32H7S7XX
```



## 编译命令

- 在哪一个目录编译就会将编译的信息生成到该目录

zephyrproject/h7s78-dk-example 目录下   （此处最好使用绝对路径来制定boards） 

```
 west build -p always -b h7s78 1.blinky -DBOARD_ROOT=/home/hdj/zephyrproject/h7s78-dk-example
```

![image-20250802195739154](https://newbie-typora.oss-cn-shenzhen.aliyuncs.com/TyporaJPG/image-20250802195739154.png)

zephyrproject/h7s78-dk-example/1.blinky 目录

```
west build -p always -b h7s78 ../1.blinky -DBOARD_ROOT=/home/hdj/zephyrproject/h7s78-dk-example
```



